FROM docker.io/andrepiske/ruby:3.3.9-bookworm-jemalloc-yjit

RUN apt-get update -y \
    && apt-get install -y build-essential m4 vim \
       autoconf automake cmake libtool \
       libzstd-dev libxml2-dev libyaml-dev \
       curl zstd libjemalloc-dev

RUN set -eux ; \
    mkdir /tmp/silesia ; cd /tmp/silesia ; \
    curl -sLfo silesia.tar.zstd https://xb1-p.us-east-1.linodeobjects.com/silesia.tar.zstd && \
    zstd -d silesia.tar.zstd && tar xf silesia.tar && \
    cp -rf /tmp/silesia/silesia /silesia && \
    rm -rf /tmp/silesia

RUN gem update --system && gem install bundler

WORKDIR /app

ENTRYPOINT ["/bin/bash"]
